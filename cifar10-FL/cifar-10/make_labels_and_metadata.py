import random
import os

# get label list
data_path = r"CIFAR-10-images"
label_list = ['airplane', 'automobile', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck']
label_list = sorted(label_list)

clients_distribution = [48, 36, 48, 97, 21, 61, 69, 56, 36, 85, 26, 54, 66, 39, 73, 8, 44, 10, 68, 22, 69, 59, 94, 89, 86, 6, 3, 5, 62, 80, 70, 94, 58, 22, 74, 16, 28, 81, 88, 73, 42, 65, 96, 34, 34, 18, 26, 36, 62, 84, 6, 75, 66, 61, 7, 7, 31, 49, 37, 19, 98, 44, 55, 74, 54, 95, 23, 76, 72, 4, 44, 44, 48, 7, 11, 28, 17, 3, 29, 21, 70, 19, 8, 1, 43, 80, 19, 3, 59, 16, 87, 24, 4, 2, 37, 38, 14, 53, 14, 29, 16, 29, 77, 81, 17, 89, 58, 54, 93, 95, 13, 80, 45, 53, 4, 50, 19, 12, 15, 88, 30, 24, 78, 79, 34, 66, 52, 37, 14, 21, 86, 86, 56, 41, 77, 95, 24, 15, 59, 49, 81, 90, 40, 66, 73, 34, 78, 35, 26, 93, 19, 36, 21, 72, 85, 95, 96, 18, 97, 39, 38, 57, 56, 51, 76, 74, 28, 66, 87, 16, 79, 59, 54, 32, 70, 28, 54, 46, 71, 96, 19, 97, 47, 52, 97, 49, 23, 43, 2, 23, 75, 56, 63, 46, 66, 25, 67, 11, 57, 16, 37, 20, 75, 57, 63, 95, 20, 42, 83, 92, 8, 41, 8, 34, 27, 10, 100, 72, 1, 32, 16, 26, 8, 24, 82, 37, 29, 22, 67, 83, 89, 41, 63, 40, 77, 38, 15, 89, 47, 66, 55, 60, 49, 31, 52, 1, 88, 53, 43, 48, 84, 3, 88, 33, 42, 68, 57, 43, 48, 67, 85, 81, 31, 53, 17, 79, 34, 7, 75, 52, 96, 13, 57, 95, 65, 14, 4, 79, 66, 70, 22, 100, 71, 30, 54, 94, 31, 29, 95, 9, 28, 98, 27, 2, 91, 41, 10, 80, 46, 85, 59, 16, 13, 36, 73, 96, 78, 41, 3, 76, 54, 30, 47, 5, 29, 38, 49, 48, 6, 54, 43, 71, 11, 86, 69, 70, 14, 62, 5, 86, 17, 96, 56, 10, 54, 62, 89, 59, 5, 33, 14, 98, 73, 48, 30, 79, 84, 48, 64, 92, 29, 55, 48, 84, 58, 33, 86, 83, 14, 28, 65, 11, 85, 94, 75, 61, 46, 80, 56, 34, 92, 100, 2, 33, 21, 71, 52, 60, 5, 57, 72, 2, 51, 70, 46, 38, 90, 100, 19, 29, 23, 98, 3, 17, 62, 21, 92, 2, 57, 58, 91, 86, 56, 54, 73, 41, 47, 37, 100, 65, 19, 23, 37, 47, 28, 55, 69, 69, 94, 25, 76, 37, 78, 86, 71, 50, 11, 64, 51, 27, 82, 98, 60, 62, 57, 35, 70, 99, 51, 79, 96, 42, 70, 81, 55, 82, 3, 34, 99, 46, 9, 38, 66, 73, 57, 98, 19, 83, 17, 58, 91, 6, 12, 68, 80, 98, 39, 86, 73, 60, 20, 49, 43, 39, 99, 81, 70, 86, 87, 38, 5, 73, 13, 8, 91, 61, 80, 65, 32, 32, 36, 2, 66, 79, 5, 43, 69, 51, 91, 60, 43, 76, 59, 8, 54, 40, 67, 55, 82, 36, 89, 21, 21, 29, 6, 41, 33, 37, 95, 43, 21, 53, 59, 3, 87, 61, 84, 25, 90, 65, 75, 14, 63, 98, 48, 4, 88, 49, 77, 1, 11, 29, 83, 71, 91, 29, 10, 31, 3, 50, 82, 14, 100, 100, 29, 9, 73, 92, 33, 76, 79, 51, 25, 31, 43, 11, 34, 57, 7, 28, 5, 31, 14, 61, 3, 91, 40, 71, 58, 97, 25, 63, 94, 21, 7, 3, 54, 92, 77, 90, 100, 78, 14, 76, 88, 69, 98, 35, 20, 88, 32, 83, 71, 72, 3, 68, 85, 67, 4, 66, 45, 19, 86, 37, 97, 67, 41, 93, 9, 48, 77, 100, 33, 99, 41, 59, 3, 91, 15, 22, 55, 43, 60, 51, 17, 23, 60, 54, 82, 30, 35, 48, 36, 21, 45, 69, 91, 76, 36, 16, 32, 57, 47, 40, 19, 34, 34, 15, 76, 49, 77, 99, 82, 32, 46, 29, 65, 100, 8, 46, 75, 11, 24, 15, 60, 26, 36, 44, 11, 85, 70, 31, 3, 93, 31, 20, 20, 20, 46, 79, 18, 73, 65, 8, 5, 43, 33, 7, 26, 59, 56, 24, 24, 2, 74, 12, 9, 37, 59, 26, 3, 29, 52, 16, 58, 35, 46, 33, 82, 9, 40, 79, 65, 20, 16, 98, 11, 16, 15, 46, 95, 87, 35, 59, 78, 61, 8, 21, 49, 83, 29, 98, 40, 95, 80, 82, 27, 48, 32, 47, 51, 57, 74, 86, 32, 34, 69, 98, 72, 43, 96, 80, 38, 64, 78, 37, 71, 26, 80, 57, 48, 40, 15, 13, 19, 29, 60, 86, 46, 86, 34, 16, 76, 85, 62, 95, 4, 54, 90, 3, 34, 12, 96, 70, 83, 60, 20, 13, 18, 17, 56, 70, 35, 5, 33, 43, 76, 48, 75, 29, 98, 38, 80, 57, 92, 26, 38, 26, 8, 100, 6, 51, 38, 27, 99, 73, 92, 36, 18, 43, 43, 60, 41, 85, 29, 33, 55, 100, 67, 12, 68, 27, 49, 85, 67, 87, 71, 44, 63, 78, 53, 92, 14, 70, 82, 17, 31, 69, 16, 78, 96, 92, 23, 3, 17, 35, 29, 68, 26, 77, 77, 9, 3, 13, 21, 43, 38, 50, 35, 5, 74, 72, 49, 10, 46, 37, 78, 63, 16, 56, 28, 24, 79, 37, 12, 31, 15, 29, 82, 68, 97, 61, 63, 11, 61, 6, 91, 36, 95, 16, 88, 39, 11, 97, 18, 35, 75, 66, 73, 32, 40, 13, 27, 59, 94, 26, 83, 15, 54, 87, 55, 80, 57, 74, 100, 28, 1, 84, 42, 76, 27, 62, 82, 59, 90, 31, 27, 21, 16, 12, 19, 80, 94, 9, 76, 7, 92, 51, 75, 67, 8, 5, 4, 44, 67, 92, 32, 72, 67, 30, 68, 95, 64, 3, 30, 50, 96, 72, 29, 28, 79, 2, 74, 19, 81, 21, 40, 58, 29, 98, 18, 81, 19, 89, 38, 37, 46, 7, 20, 86]
labels_and_metadata = []


image_id = list(range(0, 60000))
random.shuffle(image_id)

# train client
start_index = 0

for client_id in range(0, 1000):
    data_quantitiy = clients_distribution[client_id]
    end_index = start_index + data_quantitiy

    for index in range(start_index, end_index):
        image = image_id[index]
        if image >= 50000: 
            label = label_list[(image-50000)//1000]
        else:
            label = label_list[image//5000]
        metadata = {
        "user_id": str(client_id),
        "image_id": "{:05d}".format(image),
        "labels": [
            label,
        ],
        "partition": "train",
        "fine_grained_labels": [
        ]
        }
        labels_and_metadata.append(metadata)
    start_index = end_index

# val client
for client_id in range(1000, 1100):
    end_index = start_index + 50

    for index in range(start_index, end_index):
        image = image_id[index]
        if image >= 50000: 
            label = label_list[(image-50000)//1000]
        else:
            label = label_list[image//5000]
        metadata = {
        "user_id": str(client_id),
        "image_id": str(image),
        "labels": [
            label,
        ],
        "partition": "val",
        "fine_grained_labels": [
        ]
        }
        labels_and_metadata.append(metadata)

    start_index = end_index

# test client
for client_id in range(1100, 1200):
    end_index = start_index + 50

    for index in range(start_index, end_index):
        image = image_id[index]
        if image >= 50000: 
            label = label_list[(image-50000)//1000]
        else:
            label = label_list[image//5000]
        metadata = {
        "user_id": str(client_id),
        "image_id": str(image),
        "labels": [
            label,
        ],
        "partition": "test",
        "fine_grained_labels": [
        ]
        }
        labels_and_metadata.append(metadata)

    start_index = end_index

import json

with open(r"/home/chanwoo/cifar10-FL/cifar-10/labels_and_metadata.json", 'w') as f:
    json.dump(labels_and_metadata, f, indent=4)
